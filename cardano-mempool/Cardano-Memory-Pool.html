<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head id="head" data-base-url=".."><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>Cardano.Memory.Pool</title><link href="../linuwial.css" rel="stylesheet" type="text/css" title="Linuwial" /><link rel="stylesheet" type="text/css" href="../quick-jump.css" /><link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" /><script src="../haddock-bundle.min.js" async="async" type="text/javascript"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { processClass: "mathjax", ignoreClass: ".*" } });</script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><span class="caption">cardano-mempool-0.1.0.0: Short description</span><ul class="links" id="page-menu"><li><a href="src/Cardano.Memory.Pool.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>Safe-Inferred</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Cardano.Memory.Pool</p></div><div id="table-of-contents"><div id="contents-list"><p class="caption" onclick="window.scrollTo(0,0)">Contents</p><ul><li><a href="#g:1">Pool</a></li><li><a href="#g:2">Block</a></li><li><a href="#g:3">Helpers</a></li></ul></div></div><div id="description"><p class="caption">Description</p><div class="doc"><p>The goal of this Memory Pool is to provide the ability to allocate big chunks of
 memory that can fit many <code><a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a></code>s. Some memory allocators out there have a fairly large
 minimal size requirement, which would be wasteful if many chunks of small size (eg. 32
 bytes) are needed at once. Memory pool will allocate one page at a time as more blocks
 is needed.</p><p>Currently there is no functionality for releasing unused pages. So, once a page is
 allocated, it will be re-used when more <code><a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a></code>s is needed, but it will not be GCed
 until the whole <code><a href="Cardano-Memory-Pool.html#t:Pool" title="Cardano.Memory.Pool">Pool</a></code> is GCed.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><span class="keyword">data</span> <a href="#t:Pool">Pool</a> n s</li><li class="src short"><a href="#v:initPool">initPool</a> &#8759; &#8704; n s. <a href="../base/GHC-TypeLits.html#t:KnownNat" title="GHC.TypeLits">KnownNat</a> n &#8658; <a href="../base/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; (&#8704; a. <a href="../base/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="../base/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s (<a href="../base/Foreign-ForeignPtr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a)) &#8594; (<a href="../base/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> (<a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a> n) &#8594; <a href="../base/System-IO.html#t:IO" title="System.IO">IO</a> ()) &#8594; <a href="../base/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s (<a href="Cardano-Memory-Pool.html#t:Pool" title="Cardano.Memory.Pool">Pool</a> n s)</li><li class="src short"><span class="keyword">data</span> <a href="#t:Block">Block</a> (n &#8759; <a href="../base/GHC-TypeLits.html#t:Nat" title="GHC.TypeLits">Nat</a>) = <a href="#v:Block">Block</a></li><li class="src short"><a href="#v:blockByteCount">blockByteCount</a> &#8759; <a href="../base/GHC-TypeLits.html#t:KnownNat" title="GHC.TypeLits">KnownNat</a> n &#8658; <a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a> n &#8594; <a href="../base/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:grabNextBlock">grabNextBlock</a> &#8759; <a href="../base/GHC-TypeLits.html#t:KnownNat" title="GHC.TypeLits">KnownNat</a> n &#8658; <a href="Cardano-Memory-Pool.html#t:Pool" title="Cardano.Memory.Pool">Pool</a> n s &#8594; <a href="../base/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s (<a href="../base/Foreign-ForeignPtr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> (<a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a> n))</li><li class="src short"><a href="#v:countPages">countPages</a> &#8759; <a href="Cardano-Memory-Pool.html#t:Pool" title="Cardano.Memory.Pool">Pool</a> n s &#8594; <a href="../base/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s <a href="../base/Data-Int.html#t:Int" title="Data.Int">Int</a></li><li class="src short"><a href="#v:findNextZeroIndex">findNextZeroIndex</a> &#8759; &#8704; b. <a href="../base/GHC-Bits.html#t:FiniteBits" title="GHC.Bits">FiniteBits</a> b &#8658; b &#8594; <a href="../base/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base/Data-Int.html#t:Int" title="Data.Int">Int</a></li></ul></details></div><div id="interface"><a href="#g:1" id="g:1"><h1>Pool</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Pool" class="def">Pool</a> n s <a href="src/Cardano.Memory.Pool.html#Pool" class="link">Source</a> <a href="#t:Pool" class="selflink">#</a></p><div class="doc"><p>Thread-safe lock-free memory pool for managing large memory pages that contain of
 many small <code><a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a></code>s.</p></div></div><div class="top"><p class="src"><a id="v:initPool" class="def">initPool</a> <a href="src/Cardano.Memory.Pool.html#initPool" class="link">Source</a> <a href="#v:initPool" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">&#8759; &#8704; n s. <a href="../base/GHC-TypeLits.html#t:KnownNat" title="GHC.TypeLits">KnownNat</a> n</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">&#8658; <a href="../base/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p>Number of groups per page. Must be a posititve number, otherwise error. One group
 contains as many blocks as the operating system has bits. A 64bit architecture will
 have 64 blocks per group. For example, if program is compiled on a 64 bit OS and you
 know ahead of time the maximum number of blocks that will be allocated through out
 the program, then the optimal value for this argument will <code>maxBlockNum/64</code></p></td></tr><tr><td class="src">&#8594; (&#8704; a. <a href="../base/Data-Int.html#t:Int" title="Data.Int">Int</a> &#8594; <a href="../base/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s (<a href="../base/Foreign-ForeignPtr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> a))</td><td class="doc"><p>Mempool page allocator. Some allocated pages might be immediately discarded,
 therefore number of pages utilized will not necessesarely match the number of times
 this action will be called.</p></td></tr><tr><td class="src">&#8594; (<a href="../base/Foreign-Ptr.html#t:Ptr" title="Foreign.Ptr">Ptr</a> (<a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a> n) &#8594; <a href="../base/System-IO.html#t:IO" title="System.IO">IO</a> ())</td><td class="doc"><p>Finalizer to use for each block. It is an IO action because it will be executed by
 the Garbage Collector in a separate thread once the <code><a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a></code> is no longer referenced.</p></td></tr><tr><td class="src">&#8594; <a href="../base/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s (<a href="Cardano-Memory-Pool.html#t:Pool" title="Cardano.Memory.Pool">Pool</a> n s)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Initilizes the <code><a href="Cardano-Memory-Pool.html#t:Pool" title="Cardano.Memory.Pool">Pool</a></code> that can be used for further allocation of <code><code><a href="../base/Foreign-ForeignPtr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code>
 <code><a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a></code> n</code> with <code><a href="Cardano-Memory-Pool.html#v:grabNextBlock" title="Cardano.Memory.Pool">grabNextBlock</a></code>.</p></div></div><a href="#g:2" id="g:2"><h1>Block</h1></a><div class="top"><p class="src"><span class="keyword">data</span> <a id="t:Block" class="def">Block</a> (n &#8759; <a href="../base/GHC-TypeLits.html#t:Nat" title="GHC.TypeLits">Nat</a>) <a href="src/Cardano.Memory.Pool.html#Block" class="link">Source</a> <a href="#t:Block" class="selflink">#</a></p><div class="doc"><p>This is just a proxy type that carries information at the type level about the size
 of the block in bytes supported by a particular instance of a <code><a href="Cardano-Memory-Pool.html#t:Pool" title="Cardano.Memory.Pool">Pool</a></code>. Use
 <code><a href="Cardano-Memory-Pool.html#v:blockByteCount" title="Cardano.Memory.Pool">blockByteCount</a></code> to get the byte size at the value level.</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a id="v:Block" class="def">Block</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div><div class="top"><p class="src"><a id="v:blockByteCount" class="def">blockByteCount</a> &#8759; <a href="../base/GHC-TypeLits.html#t:KnownNat" title="GHC.TypeLits">KnownNat</a> n &#8658; <a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a> n &#8594; <a href="../base/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Cardano.Memory.Pool.html#blockByteCount" class="link">Source</a> <a href="#v:blockByteCount" class="selflink">#</a></p><div class="doc"><p>Number of bytes in a <code><a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a></code></p></div></div><div class="top"><p class="src"><a id="v:grabNextBlock" class="def">grabNextBlock</a> &#8759; <a href="../base/GHC-TypeLits.html#t:KnownNat" title="GHC.TypeLits">KnownNat</a> n &#8658; <a href="Cardano-Memory-Pool.html#t:Pool" title="Cardano.Memory.Pool">Pool</a> n s &#8594; <a href="../base/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s (<a href="../base/Foreign-ForeignPtr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a> (<a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a> n)) <a href="src/Cardano.Memory.Pool.html#grabNextBlock" class="link">Source</a> <a href="#v:grabNextBlock" class="selflink">#</a></p><div class="doc"><p>Reserve a <code><a href="../base/Foreign-ForeignPtr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> of the <code><a href="Cardano-Memory-Pool.html#v:blockByteCount" title="Cardano.Memory.Pool">blockByteCount</a></code> size in the <code><a href="Cardano-Memory-Pool.html#t:Pool" title="Cardano.Memory.Pool">Pool</a></code>. There is a default
 finalizer attached to the <code><a href="../base/Foreign-ForeignPtr.html#t:ForeignPtr" title="Foreign.ForeignPtr">ForeignPtr</a></code> that will run <code><a href="Cardano-Memory-Pool.html#t:Block" title="Cardano.Memory.Pool">Block</a></code> pointer finalizer and
 release that memory for re-use by other blocks allocated in the future. It is safe to
 add more Haskell finalizers with <code><a href="../base/GHC-ForeignPtr.html#v:addForeignPtrConcFinalizer" title="GHC.ForeignPtr">addForeignPtrConcFinalizer</a></code> if necessary.</p></div></div><a href="#g:3" id="g:3"><h1>Helpers</h1></a><div class="top"><p class="src"><a id="v:countPages" class="def">countPages</a> &#8759; <a href="Cardano-Memory-Pool.html#t:Pool" title="Cardano.Memory.Pool">Pool</a> n s &#8594; <a href="../base/Control-Monad-ST-Safe.html#t:ST" title="Control.Monad.ST.Safe">ST</a> s <a href="../base/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Cardano.Memory.Pool.html#countPages" class="link">Source</a> <a href="#v:countPages" class="selflink">#</a></p><div class="doc"><p>Useful function for testing. Check how many pages have been allocated thus far.</p></div></div><div class="top"><p class="src"><a id="v:findNextZeroIndex" class="def">findNextZeroIndex</a> &#8759; &#8704; b. <a href="../base/GHC-Bits.html#t:FiniteBits" title="GHC.Bits">FiniteBits</a> b &#8658; b &#8594; <a href="../base/Data-Maybe.html#t:Maybe" title="Data.Maybe">Maybe</a> <a href="../base/Data-Int.html#t:Int" title="Data.Int">Int</a> <a href="src/Cardano.Memory.Pool.html#findNextZeroIndex" class="link">Source</a> <a href="#v:findNextZeroIndex" class="selflink">#</a></p><div class="doc"><p>Helper function that finds an index of the left-most bit that is not set.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.26.0</p></div></body></html>